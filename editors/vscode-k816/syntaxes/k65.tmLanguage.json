{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "K65",
  "scopeName": "source.k65",
  "fileTypes": [
    "k65"
  ],
  "patterns": [
    {
      "include": "#preprocessor"
    },
    {
      "include": "#comments"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#mode-annotations"
    },
    {
      "include": "#labels"
    },
    {
      "include": "#keywords"
    },
    {
      "include": "#evaluator-functions"
    },
    {
      "include": "#opcodes"
    },
    {
      "include": "#registers"
    },
    {
      "include": "#numbers"
    },
    {
      "include": "#operators"
    },
    {
      "include": "#punctuation"
    }
  ],
  "repository": {
    "preprocessor": {
      "patterns": [
        {
          "name": "keyword.control.directive.k65",
          "match": "(?m)^\\s*#\\s*(?:if|elif|else|endif|error|warn)\\b"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.k65",
          "begin": "//",
          "end": "$"
        },
        {
          "name": "comment.block.k65",
          "begin": "/\\*",
          "end": "\\*/"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.k65",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.k65",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "mode-annotations": {
      "patterns": [
        {
          "name": "storage.modifier.mode.k65",
          "match": "\\B(?:@a8|@a16|@i8|@i16)\\b"
        }
      ]
    },
    "labels": {
      "patterns": [
        {
          "name": "meta.label.definition.local.k65",
          "match": "(\\.[A-Za-z_][A-Za-z0-9_@]*)(\\s*:)",
          "captures": {
            "1": {
              "name": "entity.name.label.local.k65"
            },
            "2": {
              "name": "punctuation.separator.key-value.k65"
            }
          }
        },
        {
          "name": "meta.label.definition.global.k65",
          "match": "\\b([A-Za-z_][A-Za-z0-9_@]*)(\\s*:)",
          "captures": {
            "1": {
              "name": "entity.name.label.global.k65"
            },
            "2": {
              "name": "punctuation.separator.key-value.k65"
            }
          }
        },
        {
          "name": "variable.other.local-label.k65",
          "match": "\\.[A-Za-z_][A-Za-z0-9_@]*"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.declaration.k65",
          "match": "\\b(?:func|naked|inline|far|data|segment|var|image|binary)\\b"
        },
        {
          "name": "keyword.control.k65",
          "match": "\\b(?:call|goto|break|return|return_i|else|always|never|for|repeat|eval|evaluator|code|align|address|nocross|charset|tiles|colormode|imgwave|inv)\\b"
        },
        {
          "name": "storage.type.data-width.k65",
          "match": "\\b(?:byte|word)\\b"
        }
      ]
    },
    "evaluator-functions": {
      "patterns": [
        {
          "name": "support.function.builtin.k65",
          "match": "\\b(?:sin|cos|asin|acos|sqrt|pow|floor|ceil|round|frac|min|max|clamp|rnd|index|size|addbyte|color|print|error)\\b(?=\\s*\\()"
        }
      ]
    },
    "opcodes": {
      "patterns": [
        {
          "name": "keyword.instruction.65816.k65",
          "match": "(?i)\\b(?:adc|and|asl|bcc|bcs|beq|bit|bmi|bne|bpl|bra|brk|brl|bvc|bvs|clc|cld|cli|clv|cmp|cop|cpx|cpy|dec|dex|dey|eor|inc|inx|iny|jml|jmp|jsl|jsr|lda|ldx|ldy|lsr|mvn|mvp|nop|ora|pea|pei|per|pha|phb|phd|phk|php|phx|phy|pla|plb|pld|plp|plx|ply|rep|rol|ror|rti|rtl|rts|sbc|sec|sed|sei|sep|sta|stp|stx|sty|stz|tax|tay|tcd|tcs|tdc|trb|tsb|tsc|tsx|txa|txs|txy|tya|tyx|wai|wdm|xba|xce)\\b"
        }
      ]
    },
    "registers": {
      "patterns": [
        {
          "name": "variable.language.register.k65",
          "match": "(?i)\\b(?:a|b|c|d|x|y|s|sp|pc)\\b"
        },
        {
          "name": "constant.language.flag.k65",
          "match": "(?i)\\b(?:n|v|o|m|x|b|d|i|z|c|e)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.hex.k65",
          "match": "(?<![A-Za-z0-9_$])(?:0x[0-9A-Fa-f_]+|\\$[0-9A-Fa-f_]+)\\b"
        },
        {
          "name": "constant.numeric.binary.k65",
          "match": "(?<![A-Za-z0-9_%])(?:0b[01_]+|%[01_]+)\\b"
        },
        {
          "name": "constant.numeric.float.k65",
          "match": "(?<![A-Za-z0-9_\\.])(?:\\d+\\.\\d*|\\.\\d+)(?:[eE][+-]?\\d+)?\\b"
        },
        {
          "name": "constant.numeric.decimal.k65",
          "match": "(?<![A-Za-z0-9_\\.])\\d+\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.k65",
          "match": "><|\\+\\+|--|<<=|>>=|\\+=|-=|\\*=|/=|%=|&=|\\^=|\\|=|==|!=|<=|>=|&&|\\|\\||<<|>>|\\?>|\\?<|&<|&>|[=+\\-*/%&|^~!?<>]"
        }
      ]
    },
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.separator.sequence.k65",
          "match": ";|,"
        },
        {
          "name": "punctuation.section.block.begin.k65",
          "match": "[\\[{(]"
        },
        {
          "name": "punctuation.section.block.end.k65",
          "match": "[\\]})]"
        }
      ]
    }
  }
}
